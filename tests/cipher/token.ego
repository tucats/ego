@test "cipher token functions"

import cipher

// Simple test of storing user data
{
	msg := "hidden message"
	t := cipher.token(msg)
	@assert cipher.valid(t) == true "token is not valid"package cipher
	@assert cipher.getuser(t) == msg "token does not contain expected user data"
}

{
	msg := "hidden message"
	t := cipher.token(msg) + "0"
	@assert cipher.valid(t) == false "token is not invalid"
	@assert cipher.getuser(t) ==  false "token does not contain empty user data"
}
{
	td := profile.get("token-expiration")
	if td == "" {
		td := "5m"
	}
	call profile.set("token-expiration", ".5s")
	t := cipher.token("test")
	call time.sleep("1s")
	@assert cipher.valid(t) == false "token should have been invalid"
	call profile.set("token-expiration", td)
}

@pass